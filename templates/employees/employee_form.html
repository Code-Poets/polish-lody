{% extends 'polishlody/base.html' %}
{% load widget_tweaks %}
{% load i18n %}

{% block title %}{% trans 'Employee' %}{% endblock %}
{% block header_block %}

<style type="text/css">

.autocomplete-suggestions { border: 1px solid #999; background: #FFF; overflow: auto; }
.autocomplete-suggestion { padding: 2px 5px; white-space: nowrap; overflow: hidden; }
.autocomplete-selected { background: #F0F0F0; }
.autocomplete-suggestions strong { font-weight: normal; color: #819839; }
.autocomplete-group { padding: 2px 5px; }
.autocomplete-group strong { display: block; border-bottom: 1px solid #000; }

</style>

<div class="panel panel-heading panel-default">
    <h4>
        <center>
            {% if employee %}
                {{ employee.full_name }}
            <a href="{% url 'employee_detail' employee.id %}" class="btn btn-default">{% trans 'Back' %}</a>
            {% else %}
                {% trans 'New employee' %}
            <a href="{% url 'employees' %}" class="btn btn-default">{% trans 'Back' %}</a>
            {% endif %}
        </center>
    </h4>
</div>
{% endblock %}
{% block body_block %}
    <div class="panel panel-heading panel-default">
        <div class="form-container">
            <form method="post" class="form-horizontal">
                {% csrf_token %}
                {% for error in form.non_field_errors %}
                    <div class="alert alert-danger" role="alert">
                        {{ error }}
                    </div>
                {% endfor %}
                {% if form.errors %}
                    <div class="alert alert-danger" role="alert">
                        {{ form.email.errors }}
                        {{ form.first_name.errors }}
                        {{ form.last_name.errors }}
                        {{ form.password1.errors }}
                        {{ form.password2.errors }}
                        {{ form.contract_start_date.errors }}
                        {{ form.contract_exp_date.errors }}
                        {{ form.health_book_exp_date.errors }}
                        {{ form.bank_account_number.errors }}
                        {{ form.phone_contact_number.errors }}
                        {{ form.address_zip_code.errors }} 
                        {% if form.address_city.errors %}
                        {% trans 'Please type a valid city as provided by the list of suggestions' %}
                        {% endif %}                   
                    </div>
                {% endif %}
                {% for e in form %}
                    <div class="form-group">
                        {% if e.html_name == 'email' or e.html_name == 'first_name' or e.html_name == 'last_name' %}
                        <label class="col-sm-4 control-label">{{ e.label }}<span class="required"> *</span></label>
                        <div class="input-group col-sm-6">
                            {{ e|add_class:"form-control" }}
                            {% if e.html_name == 'email' %}
                                <span class="glyphicon glyphicon-remove icon-false verify-email"></span>
                            {% endif %}
                        </div>
                        {% elif e.html_name == 'contract_start_date' or e.html_name == 'contract_exp_date' or e.html_name == 'health_book_exp_date' %}
                        <label class="col-sm-4 control-label">{{ e.label }}</label>
                        <div class="input-group col-sm-6">
                            <span class="input-group-addon"><span class="glyphicon glyphicon-calendar"></span></span>
                            {{ e|add_class:"form-control" }}
                        </div>
                        {% elif e.html_name == "gender" %}
                        <label class="col-sm-4 control-label">{{ e.label }}</label>
                        <div class="radio-select col-sm-6 ">
                            {{ e }}
                        </div>
                        {% else %}
                        <label class="col-sm-4 control-label">{{ e.label }}</label>
                        <div class="input-group col-sm-6 ">
                            {{ e|add_class:"form-control" }}
                        </div>
                        {% endif %}
                    </div>
                {% endfor %}
                <br>
                <center>
                    <input type="submit" name="submit" value="{% trans 'Submit' %}" class="btn btn-primary">
                    {% if employee and user.is_staff %}
                        <a href="{% url 'employee_delete' employee.id %}" class="btn btn-danger">{% trans 'Delete employee' %}</a>
                    {% else %}
                    {% endif %}
                    
                </center>
                <br>
            </form>
        </div>
    </div>

<script>

$(document).ready(function(){
    $('#id_bank_account_number').mask('00 0000 0000 0000 0000 0000 0000')
    $('#id_phone_contact_number').mask('+00 000 000 000')
    $('#id_address_zip_code').mask('00-000');

});

document.getElementById("id_address_city").onkeyup = function() {formatCityText()};

function formatCityText() {
    var cityhtml = document.getElementById("id_address_city");
    var city = cityhtml.value;
    var regex = /[^a-zA-Z\u0104\u0106\u0118\u0141\u0143\u00D3\u015A\u0179\u017B\u0105\u0107\u0119\u0142\u0144\u00F3\u015B\u017A\u017C -]/g;
    city = city.replace(regex, "");
    var re = /(-|\s)/g;
    city = city.toLowerCase().split(re);
    for (var i=0; i<city.length; i++) {
        var placeholder = city[i];
        var UpLetter = placeholder.charAt(0).toUpperCase();
        placeholder = placeholder.slice(1,placeholder.length);
        city[i] = UpLetter.concat(placeholder);
      }
    city = city.join("");
    cityhtml.value = city;

}
</script>

<script type="text/javascript" src="{% url 'javascript-catalog' %}"></script> <!-- javascript strings translations -->
<script>

$(function() {
  
  $("#id_address_city").autocomplete({
    
    serviceUrl: "/employees/autocomplete/",
    minChars: 3

  });

});

</script>

{% endblock %}